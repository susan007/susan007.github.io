<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>wx:key | 静静是小花</title>
    <meta name="description" content="认识你自己">
    <link rel="icon" href="/flower.png">
  <link rel="manifest" href="/manifest.json">
    
    <link rel="preload" href="/assets/css/0.styles.c4c4d776.css" as="style"><link rel="preload" href="/assets/js/app.d2b44f7f.js" as="script"><link rel="preload" href="/assets/js/7.a1b3f1a1.js" as="script"><link rel="prefetch" href="/assets/js/10.470fe691.js"><link rel="prefetch" href="/assets/js/100.577d16e6.js"><link rel="prefetch" href="/assets/js/101.79c320e3.js"><link rel="prefetch" href="/assets/js/102.ed175b12.js"><link rel="prefetch" href="/assets/js/103.6b70709b.js"><link rel="prefetch" href="/assets/js/104.16de6d7e.js"><link rel="prefetch" href="/assets/js/105.870e5b01.js"><link rel="prefetch" href="/assets/js/106.3d1d55c2.js"><link rel="prefetch" href="/assets/js/107.589b5b6c.js"><link rel="prefetch" href="/assets/js/108.808c9742.js"><link rel="prefetch" href="/assets/js/109.1e2db90c.js"><link rel="prefetch" href="/assets/js/11.6f61b487.js"><link rel="prefetch" href="/assets/js/110.794233d3.js"><link rel="prefetch" href="/assets/js/111.8ed9468a.js"><link rel="prefetch" href="/assets/js/112.e5c7cd0e.js"><link rel="prefetch" href="/assets/js/113.7183406e.js"><link rel="prefetch" href="/assets/js/114.9eef3f4b.js"><link rel="prefetch" href="/assets/js/115.131240de.js"><link rel="prefetch" href="/assets/js/116.ca261d4a.js"><link rel="prefetch" href="/assets/js/117.a652aa4e.js"><link rel="prefetch" href="/assets/js/118.6451f163.js"><link rel="prefetch" href="/assets/js/119.5eab0557.js"><link rel="prefetch" href="/assets/js/12.bcf9c968.js"><link rel="prefetch" href="/assets/js/120.7c6856ba.js"><link rel="prefetch" href="/assets/js/121.0273a971.js"><link rel="prefetch" href="/assets/js/122.e1fd0ad9.js"><link rel="prefetch" href="/assets/js/123.d9bad0bb.js"><link rel="prefetch" href="/assets/js/124.ba65cb2d.js"><link rel="prefetch" href="/assets/js/125.9b987390.js"><link rel="prefetch" href="/assets/js/126.1ec43dfd.js"><link rel="prefetch" href="/assets/js/127.983e95d4.js"><link rel="prefetch" href="/assets/js/128.a072288e.js"><link rel="prefetch" href="/assets/js/129.3127e0f3.js"><link rel="prefetch" href="/assets/js/13.096b3ba5.js"><link rel="prefetch" href="/assets/js/130.3b2e9f62.js"><link rel="prefetch" href="/assets/js/131.704fa936.js"><link rel="prefetch" href="/assets/js/132.6ea4d615.js"><link rel="prefetch" href="/assets/js/133.3fcb825c.js"><link rel="prefetch" href="/assets/js/134.e130aa26.js"><link rel="prefetch" href="/assets/js/135.edc0365c.js"><link rel="prefetch" href="/assets/js/136.2a75bcff.js"><link rel="prefetch" href="/assets/js/137.68a8172f.js"><link rel="prefetch" href="/assets/js/138.d26f0d22.js"><link rel="prefetch" href="/assets/js/139.8e43988f.js"><link rel="prefetch" href="/assets/js/14.b49ae643.js"><link rel="prefetch" href="/assets/js/140.534ebfa7.js"><link rel="prefetch" href="/assets/js/141.ec1bb9c2.js"><link rel="prefetch" href="/assets/js/142.5a6924d1.js"><link rel="prefetch" href="/assets/js/143.04a8a8cf.js"><link rel="prefetch" href="/assets/js/15.b4b1a405.js"><link rel="prefetch" href="/assets/js/16.85053a7d.js"><link rel="prefetch" href="/assets/js/17.cf134c44.js"><link rel="prefetch" href="/assets/js/18.f2429861.js"><link rel="prefetch" href="/assets/js/19.bb7f7d8a.js"><link rel="prefetch" href="/assets/js/2.ba3474bd.js"><link rel="prefetch" href="/assets/js/20.2b3a51f5.js"><link rel="prefetch" href="/assets/js/21.df02be4a.js"><link rel="prefetch" href="/assets/js/22.50e21ba4.js"><link rel="prefetch" href="/assets/js/23.ece85aa3.js"><link rel="prefetch" href="/assets/js/24.c19680d9.js"><link rel="prefetch" href="/assets/js/25.125a6404.js"><link rel="prefetch" href="/assets/js/26.722ffb85.js"><link rel="prefetch" href="/assets/js/27.5b54c7f9.js"><link rel="prefetch" href="/assets/js/28.1c9eec54.js"><link rel="prefetch" href="/assets/js/29.f8fee67b.js"><link rel="prefetch" href="/assets/js/3.a15d4d8d.js"><link rel="prefetch" href="/assets/js/30.da97728e.js"><link rel="prefetch" href="/assets/js/31.3f0f82e5.js"><link rel="prefetch" href="/assets/js/32.02edf343.js"><link rel="prefetch" href="/assets/js/33.111554a5.js"><link rel="prefetch" href="/assets/js/34.7004eb43.js"><link rel="prefetch" href="/assets/js/35.fc1f75d8.js"><link rel="prefetch" href="/assets/js/36.041c3bdb.js"><link rel="prefetch" href="/assets/js/37.2ef648b5.js"><link rel="prefetch" href="/assets/js/38.9c74cbf0.js"><link rel="prefetch" href="/assets/js/39.4421a3c1.js"><link rel="prefetch" href="/assets/js/4.884dbda8.js"><link rel="prefetch" href="/assets/js/40.3120dd63.js"><link rel="prefetch" href="/assets/js/41.ef5c4f14.js"><link rel="prefetch" href="/assets/js/42.3c80c76d.js"><link rel="prefetch" href="/assets/js/43.8565e63a.js"><link rel="prefetch" href="/assets/js/44.37c337ba.js"><link rel="prefetch" href="/assets/js/45.5adba985.js"><link rel="prefetch" href="/assets/js/46.33102f67.js"><link rel="prefetch" href="/assets/js/47.7008d62b.js"><link rel="prefetch" href="/assets/js/48.e0e8270f.js"><link rel="prefetch" href="/assets/js/49.9e3b5052.js"><link rel="prefetch" href="/assets/js/5.6bf79a0a.js"><link rel="prefetch" href="/assets/js/50.6e3314de.js"><link rel="prefetch" href="/assets/js/51.251523e3.js"><link rel="prefetch" href="/assets/js/52.0870e019.js"><link rel="prefetch" href="/assets/js/53.c5efbcaf.js"><link rel="prefetch" href="/assets/js/54.2c549b52.js"><link rel="prefetch" href="/assets/js/55.f0f16d71.js"><link rel="prefetch" href="/assets/js/56.93e93d14.js"><link rel="prefetch" href="/assets/js/57.1d10770b.js"><link rel="prefetch" href="/assets/js/58.580c15a1.js"><link rel="prefetch" href="/assets/js/59.cd28731f.js"><link rel="prefetch" href="/assets/js/6.168eb2fa.js"><link rel="prefetch" href="/assets/js/60.7e2dad9c.js"><link rel="prefetch" href="/assets/js/61.df95a792.js"><link rel="prefetch" href="/assets/js/62.91cbceb9.js"><link rel="prefetch" href="/assets/js/63.21e6f2b5.js"><link rel="prefetch" href="/assets/js/64.3187dac3.js"><link rel="prefetch" href="/assets/js/65.b0656364.js"><link rel="prefetch" href="/assets/js/66.fbfec557.js"><link rel="prefetch" href="/assets/js/67.009e5fae.js"><link rel="prefetch" href="/assets/js/68.a97be3d2.js"><link rel="prefetch" href="/assets/js/69.ef85c875.js"><link rel="prefetch" href="/assets/js/70.7ab298cc.js"><link rel="prefetch" href="/assets/js/71.503ea3ad.js"><link rel="prefetch" href="/assets/js/72.ebac1d49.js"><link rel="prefetch" href="/assets/js/73.e12d0bff.js"><link rel="prefetch" href="/assets/js/74.cb2bea0d.js"><link rel="prefetch" href="/assets/js/75.e279ab19.js"><link rel="prefetch" href="/assets/js/76.84f56e79.js"><link rel="prefetch" href="/assets/js/77.7ac3a2e2.js"><link rel="prefetch" href="/assets/js/78.17f8c449.js"><link rel="prefetch" href="/assets/js/79.262491e8.js"><link rel="prefetch" href="/assets/js/8.546d26bc.js"><link rel="prefetch" href="/assets/js/80.133c8974.js"><link rel="prefetch" href="/assets/js/81.2682456f.js"><link rel="prefetch" href="/assets/js/82.07eba366.js"><link rel="prefetch" href="/assets/js/83.7656aaf8.js"><link rel="prefetch" href="/assets/js/84.a4caf639.js"><link rel="prefetch" href="/assets/js/85.02976b87.js"><link rel="prefetch" href="/assets/js/86.ab3a5675.js"><link rel="prefetch" href="/assets/js/87.6637634c.js"><link rel="prefetch" href="/assets/js/88.4bced27d.js"><link rel="prefetch" href="/assets/js/89.f8fc561a.js"><link rel="prefetch" href="/assets/js/9.4cd62c8f.js"><link rel="prefetch" href="/assets/js/90.8b2ada9d.js"><link rel="prefetch" href="/assets/js/91.28052167.js"><link rel="prefetch" href="/assets/js/92.010f808c.js"><link rel="prefetch" href="/assets/js/93.2f83e5d8.js"><link rel="prefetch" href="/assets/js/94.48e6293b.js"><link rel="prefetch" href="/assets/js/95.66b8f0d1.js"><link rel="prefetch" href="/assets/js/96.3b8e3cba.js"><link rel="prefetch" href="/assets/js/97.6ea28c60.js"><link rel="prefetch" href="/assets/js/98.6f7d1636.js"><link rel="prefetch" href="/assets/js/99.f49e5ba2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c4c4d776.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">静静是小花</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/WEB/" class="nav-link">前端</a></div><div class="nav-item"><a href="/SOURCE/" class="nav-link router-link-active">冷门</a></div><div class="nav-item"><a href="/PERSONAL/" class="nav-link">关于</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/WEB/" class="nav-link">前端</a></div><div class="nav-item"><a href="/SOURCE/" class="nav-link router-link-active">冷门</a></div><div class="nav-item"><a href="/PERSONAL/" class="nav-link">关于</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>小程序</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/SOURCE/wx-key.html" aria-current="page" class="active sidebar-link">微信小程序采坑帖</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/SOURCE/wx-key.html#wx-key" class="sidebar-link">wx:key</a></li><li class="sidebar-sub-header"><a href="/SOURCE/wx-key.html#cover-view" class="sidebar-link">cover-view</a></li><li class="sidebar-sub-header"><a href="/SOURCE/wx-key.html#map" class="sidebar-link">map</a></li><li class="sidebar-sub-header"><a href="/SOURCE/wx-key.html#自定义组件" class="sidebar-link">自定义组件</a></li><li class="sidebar-sub-header"><a href="/SOURCE/wx-key.html#wx-for获取某个item的值" class="sidebar-link">wx:for获取某个item的值</a></li><li class="sidebar-sub-header"><a href="/SOURCE/wx-key.html#引入weui-wxss" class="sidebar-link">引入weui.wxss</a></li><li class="sidebar-sub-header"><a href="/SOURCE/wx-key.html#登录" class="sidebar-link">登录</a></li><li class="sidebar-sub-header"><a href="/SOURCE/wx-key.html#授权" class="sidebar-link">授权</a></li><li class="sidebar-sub-header"><a href="/SOURCE/wx-key.html#获取手机号" class="sidebar-link">获取手机号</a></li><li class="sidebar-sub-header"><a href="/SOURCE/wx-key.html#微信支付" class="sidebar-link">微信支付</a></li><li class="sidebar-sub-header"><a href="/SOURCE/wx-key.html#echarts使用" class="sidebar-link">echarts使用</a></li><li class="sidebar-sub-header"><a href="/SOURCE/wx-key.html#wx-navigateto" class="sidebar-link">wx.navigateTo</a></li><li class="sidebar-sub-header"><a href="/SOURCE/wx-key.html#vant-weapp使用" class="sidebar-link">vant-weapp使用</a></li><li class="sidebar-sub-header"><a href="/SOURCE/wx-key.html#wxs应用" class="sidebar-link">wxs应用</a></li><li class="sidebar-sub-header"><a href="/SOURCE/wx-key.html#input标签" class="sidebar-link">input标签</a></li><li class="sidebar-sub-header"><a href="/SOURCE/wx-key.html#自定义组件slot" class="sidebar-link">自定义组件slot</a></li><li class="sidebar-sub-header"><a href="/SOURCE/wx-key.html#自定义组件外部样式定义" class="sidebar-link">自定义组件外部样式定义</a></li><li class="sidebar-sub-header"><a href="/SOURCE/wx-key.html#自定义nav" class="sidebar-link">自定义nav</a></li></ul></li><li><a href="/SOURCE/小程序.html" class="sidebar-link">我与小程序二三事</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>其他技术</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>望穿秋水</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><p>此贴作为小程序采坑帖，记录小程序开发中遇到的采坑记录</p> <h2 id="wx-key"><a href="#wx-key" class="header-anchor">#</a> <code>wx:key</code></h2> <p>学习小程序列表渲染的时候，涉及到几个属性<code>wx:for</code>、<code>wx:for-index</code>、<code>wx:for-item</code>、<code>wx:key</code>，前三个都非常好理解绑定要渲染的数组、指定数组当前下标的变量名、指定数组当前元素的变量名，今天重点讲讲较难理解的<code>wx:key</code>。</p> <h3 id="官方定义"><a href="#官方定义" class="header-anchor">#</a> <a href="https://developers.weixin.qq.com/miniprogram/dev/reference/wxml/list.html#wx:key" target="_blank" rel="noopener noreferrer">官方定义<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <p>如果列表中项目的位置会动态改变或者有新的项目添加到列表中，并且希望列表中的项目保持自己的特征和状态（如 input 中的输入内容，switch 的选中状态），需要使用 wx:key 来指定列表中项目的唯一的标识符。</p> <p>乍一看有点难理解啊2333，那我们就动手做做看看列表渲染加和不加wx:key会出现什么？</p> <h3 id="wx-key-警告"><a href="#wx-key-警告" class="header-anchor">#</a> wx:key 警告</h3> <p>js文件中的数据</p> <div class="language-js extra-class"><pre class="language-js"><code>data<span class="token operator">:</span> <span class="token punctuation">{</span>
    switchArray<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            id<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            value<span class="token operator">:</span> <span class="token string">'朋友圈'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            value<span class="token operator">:</span> <span class="token string">'扫一扫'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            value<span class="token operator">:</span> <span class="token string">'摇一摇'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>源码</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>switch</span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{switchArray}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for-index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myIndex<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for-item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myItem<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{myIndex}}: {{myItem.id}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>switch</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>此时控制台警告如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 现在你可以为`wx：for`提供attr`wx：key`来提高性能。</span>
Now you can provide attr <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">wx:key</span><span class="token template-punctuation string">`</span></span> <span class="token keyword">for</span> a <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">wx:for</span><span class="token template-punctuation string">`</span></span> to improve performance<span class="token punctuation">.</span>
</code></pre></div><p>加上wx:key警告消失</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 值为被循环对象的某个属性，且该属性值为字符串或数字</span>
wx<span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">&quot;id&quot;</span>
</code></pre></div><h3 id="wx-key-作用"><a href="#wx-key-作用" class="header-anchor">#</a> wx:key 作用</h3> <p>列表中项目的位置会变化（比如排序），或者会插入新的项目（前后插入新项目），而此时要保持已有项目的特征和状态（比如input的输入值或者checkbox的勾选状态），就要使用wx:key来指定列表中项目的唯一标识符。</p> <h3 id="wx-key-形式"><a href="#wx-key-形式" class="header-anchor">#</a> wx:key 形式</h3> <ul><li>字符串或数字：item的某个property,且不能重复。（比如上例中的id）</li> <li>保留关键字<code>*this</code>，需要item是一个唯一的字符串或数字。</li></ul> <h2 id="cover-view"><a href="#cover-view" class="header-anchor">#</a> <code>cover-view</code></h2> <p>cover-view是小程序中的一个视图容器，可覆盖在原生组件上（map/video等组件层级很高，自己设置z-index不生效的，所以cover-view就出现了）。</p> <h3 id="局限性"><a href="#局限性" class="header-anchor">#</a> <a href="https://developers.weixin.qq.com/miniprogram/dev/component/cover-view.html" target="_blank" rel="noopener noreferrer">局限性<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3> <ul><li>cover-view容器只能包含cover-view/cover-image/button。（对，你没看错，就支持嵌套这几种控件2333）</li> <li>诸多bug，比如不支持嵌套其他组件（会直接被忽略），不支持设置border等样式。</li></ul> <h3 id="我妄想在map上覆盖一个input输入框怎么办？"><a href="#我妄想在map上覆盖一个input输入框怎么办？" class="header-anchor">#</a> 我妄想在map上覆盖一个input输入框怎么办？</h3> <ul><li>直接在map上写一个input，虽被忽略但是能获取焦点但是无法设置样式。</li> <li>写一个cover-view悬浮在input相同的位置，给cover-view设置样式，假装我是一个input。</li> <li>input焦点有了、样式有了，假装完美，但是问题多多，慎用。</li> <li><a href="https://www.jianshu.com/p/6f8f13c613e7" target="_blank" rel="noopener noreferrer">参考代码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="map"><a href="#map" class="header-anchor">#</a> map</h2> <p>微信小程序地图组件</p> <h3 id="坑汇总"><a href="#坑汇总" class="header-anchor">#</a> 坑汇总</h3> <ul><li>写在map中的元素，视觉上是浮在map之上，实质上设置事件无效，因此建议写在cover-view中。</li></ul> <h2 id="自定义组件"><a href="#自定义组件" class="header-anchor">#</a> 自定义组件</h2> <p>直接给子组件绑定事件不生效，需要设置事件触发并设置事件监听</p> <h3 id="流程总结如下"><a href="#流程总结如下" class="header-anchor">#</a> 流程总结如下</h3> <ul><li><code>triggerEvent</code>：在组件中用来触发事件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 假如component名称为 my-component</span>
<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  properties<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">myEvent</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">var</span> myEventDetail <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// detail对象，提供给事件监听函数</span>
      <span class="token keyword">var</span> myEventOption <span class="token operator">=</span> <span class="token punctuation">{</span>
          bubbles<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否事件冒泡（事件冒泡你懂得，不过真有这样的需求？）</span>
          composed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 设置为true会触发组件内部的事件，也就是假如有一个自定义组件也定义了一个事件，那么这个事件也会被触发</span>
          capturePhase<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 事件是否拥有捕获阶段</span>
      <span class="token punctuation">}</span> <span class="token comment">// 触发事件的选项</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">triggerEvent</span><span class="token punctuation">(</span><span class="token string">'myEvent'</span><span class="token punctuation">,</span> myEventDetail<span class="token punctuation">,</span> myEventOption<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>给组件添加事件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在my-component中添加事件</span>
<span class="token operator">&lt;</span>button bind<span class="token operator">:</span>tap<span class="token operator">=</span><span class="token string">&quot;myEvent&quot;</span><span class="token operator">&gt;</span>点我点我<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
</code></pre></div><ul><li>页面中调用组件并绑定事件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 页面中引入组件</span>
<span class="token operator">&lt;</span>view<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>my<span class="token operator">-</span>component bind<span class="token operator">:</span>myEvent<span class="token operator">=</span><span class="token string">&quot;toDo&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>my<span class="token operator">-</span>component<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
<span class="token comment">// 父亲中定义事件</span>
<span class="token function-variable function">toDo</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'你造吗，我是你爸爸。'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="wx-for获取某个item的值"><a href="#wx-for获取某个item的值" class="header-anchor">#</a> wx:for获取某个item的值</h2> <ul><li>可直接使用<code>data-</code>绑定属性获取，比如<code>data-info=&quot;&quot;</code>给每个元素添加值；直接在相应元素的事件<code>function(e)</code>中，通过e可以获取到整个item的值。</li></ul> <h2 id="引入weui-wxss"><a href="#引入weui-wxss" class="header-anchor">#</a> 引入<a href="https://github.com/Tencent/weui-wxss" target="_blank" rel="noopener noreferrer">weui.wxss<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <ul><li>拷贝dist-style文件夹下的weui.wxss到小程序的最外层目录中</li> <li>在app.js中导入weui.wxss文件（@import './weui.wxss'）</li> <li>直接在page中使用weui.wxss的样式即可，具体可参考example文件夹的例子</li></ul> <h3 id="注意"><a href="#注意" class="header-anchor">#</a> 注意</h3> <p>在Components中使用weui.wxss样式不生效，需要单独按需把样式文件拷贝进组件文件夹中</p> <h3 id="其他ui库"><a href="#其他ui库" class="header-anchor">#</a> 其他UI库</h3> <p><a href="https://mina.wiki/eco/ui.html#weui-for-%E5%B0%8F%E7%A8%8B%E5%BA%8F" target="_blank" rel="noopener noreferrer">小程序UI库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="登录"><a href="#登录" class="header-anchor">#</a> 登录</h2> <p>用流程图总结一下，如有误请指正。
<img src="/assets/img/wx-login.80a02220.png" alt></p> <p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html" target="_blank" rel="noopener noreferrer">小程序登录流程记录参考文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="授权"><a href="#授权" class="header-anchor">#</a> 授权</h2> <p><img src="/assets/img/wx-auth.fa7ef178.png" alt></p> <h2 id="获取手机号"><a href="#获取手机号" class="header-anchor">#</a> 获取手机号</h2> <p>手机号和用户信息必须用按钮来获取了，说是这样更友好。</p> <p><img src="/assets/img/wx-phone.09a5b7c0.png" alt></p> <h2 id="微信支付"><a href="#微信支付" class="header-anchor">#</a> 微信支付</h2> <p><img src="/assets/img/wx-pay.8f125cbd.png" alt></p> <p><a href="https://pay.weixin.qq.com/wiki/doc/api/wxa/wxa_api.php?chapter=7_4&index=3" target="_blank" rel="noopener noreferrer">小程序支付交互流程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://segmentfault.com/a/1190000007737052" target="_blank" rel="noopener noreferrer">预留参考文章<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="echarts使用"><a href="#echarts使用" class="header-anchor">#</a> <a href="https://github.com/ecomfe/echarts-for-weixin" target="_blank" rel="noopener noreferrer">echarts使用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>在微信小程序中使用图表插件，这里总结一下echarts的使用，另外还有其他图标库供选择<a href="https://github.com/antvis/wx-f2" target="_blank" rel="noopener noreferrer">antv-f2小-程序示例<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（antv-f2是静态的图表，点击无交互）。</p> <p>我选择echarts是因为是大厂出品且关注度相对较高，采坑的人相对较多，经验帖或者issues丰富，且是动态交互更友好。（虽然它已经八个月没更新了o(╯□╰)o）</p> <h3 id="引入echarts库"><a href="#引入echarts库" class="header-anchor">#</a> 引入echarts库</h3> <ul><li>直接下载<a href="https://github.com/ecomfe/echarts-for-weixin" target="_blank" rel="noopener noreferrer">echarts<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>库，并拷贝ec-canvas文件夹到你的工程中。</li> <li>在第一步下载的工程中，pages文件夹为小程序使用示例，可多做参考。</li></ul> <h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <ul><li>注册组件<code>&quot;ec-canvas&quot;: &quot;/ec-canvas/ec-canvas&quot;</code></li> <li>wxml中使用组件<code>&lt;ec-canvas id=&quot;mychart-dom-pie&quot; canvas-id=&quot;mychart-pie&quot; ec=&quot;&quot; params=&quot;&quot;&gt;&lt;/ec-canvas&gt;</code></li> <li>js文件中实例化图表，主要方法使用echarts中的initChart(canvas, width, height)方法。（强烈建议参考官方demo）</li> <li>至此，page中使用echarts已经结束了，图像可以正常展示出来。但我们的目标是做成组件，方便在任何页面引用，那就继续。</li></ul> <h3 id="封装组件"><a href="#封装组件" class="header-anchor">#</a> 封装组件</h3> <ul><li>传参：思考下哪些数据需要动态传入，将它们提取出来，比如饼图中，我的提取如下：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// series中的data参数需要作为参数动态传入</span>
params<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> Array<span class="token punctuation">,</span>
    value<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        value<span class="token operator">:</span> <span class="token number">55</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token string">'苹果'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        value<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token string">'香蕉'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        value<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        name<span class="token operator">:</span> <span class="token string">'橘子'</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>改写<code>initChart(canvas, width, height)</code>方法为<code>initChart(canvas, width, height, params)</code>，因为params参数势必要动态传入。</li> <li>改写<code>ec-canvas.js</code>文件，加入params参数，并修改onInit方法，加入参数params，至此完成组件封装。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ec-canvas.js文件中加入我们的参数</span>
properties<span class="token operator">:</span> <span class="token punctuation">{</span>
    params<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Object<span class="token punctuation">,</span>
      <span class="token function-variable function">observer</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newVal<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ec-canvas.js文件中，onInit方法中加入参数this.data.params</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>chart <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>ec<span class="token punctuation">.</span><span class="token function">onInit</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> res<span class="token punctuation">.</span>width<span class="token punctuation">,</span> res<span class="token punctuation">.</span>height<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="采坑和总结"><a href="#采坑和总结" class="header-anchor">#</a> 采坑和总结</h3> <h4 id="封装echarts组件为什么改写源码？"><a href="#封装echarts组件为什么改写源码？" class="header-anchor">#</a> 封装echarts组件为什么改写源码？</h4> <blockquote><p>一开始没改写源码，而是在组件的methods中对 initChart(canvas, width, height, params) 方法做了封装initPie（为了获取父组件传的参数），然后在wxml中使用bind:init=&quot;initPie&quot;，但是这样渲染出来的图是静态无交互的，达不到效果。最终使用上面修改源码的方法得到的是正常的图。
如果你有更好的解决办法请告诉我，非常感谢(#^.^#)</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
   * 组件的方法列表
   */</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">initPie</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'--initPie--'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token function">initChart</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>canvas<span class="token punctuation">,</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>width<span class="token punctuation">,</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>height<span class="token punctuation">,</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>wxml文件中调用方法initPie</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ec-canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mychart-dom-pie<span class="token punctuation">&quot;</span></span> <span class="token attr-name">canvas-id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mychart-pie<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ec</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{ec}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">bind:</span>init</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>initPie<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-params</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{params}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ec-canvas</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h6 id="参考文章-小程序引入多个e-charts图表"><a href="#参考文章-小程序引入多个e-charts图表" class="header-anchor">#</a> 参考文章 <a href="https://juejin.im/post/5c74af0ef265da2dd0524c9e" target="_blank" rel="noopener noreferrer">小程序引入多个e-charts图表<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h6> <h4 id="圆环图点击后中间部位渲染出颜色？"><a href="#圆环图点击后中间部位渲染出颜色？" class="header-anchor">#</a> 圆环图点击后中间部位渲染出颜色？</h4> <p>点击圆环图，莫名其妙圆圈中间白色部分也有相应颜色，官方没有给出解决办法，在issues中看到<a href="https://github.com/ecomfe/echarts-for-weixin/issues/480" target="_blank" rel="noopener noreferrer">非官方解决办法1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><a href="https://github.com/ecomfe/echarts-for-weixin/issues/314" target="_blank" rel="noopener noreferrer">非官方解决办法2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>按照上面的解决办法，发现点击图例后又出现了圆环渲染内径的情况，所以取消掉了图例的点击事件<code>selectedMode： false</code>。</p> <h4 id="一个页面中加载多个echarts图表，滚动后图表卡顿或显示为空白"><a href="#一个页面中加载多个echarts图表，滚动后图表卡顿或显示为空白" class="header-anchor">#</a> 一个页面中加载多个echarts图表，滚动后图表卡顿或显示为空白</h4> <p>这个问题官方也没解决，请参考issues解决思路<a href="https://github.com/ecomfe/echarts-for-weixin/issues/331" target="_blank" rel="noopener noreferrer">echarts图表空白<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="wx-navigateto"><a href="#wx-navigateto" class="header-anchor">#</a> <a href="https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.navigateTo.html#%E5%8F%82%E6%95%B0" target="_blank" rel="noopener noreferrer">wx.navigateTo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>这里想特别说一下小程序跳转新加的事件events和eventChannel，这两个东西可以完成跳转页面之间的通讯。熟悉android或者java的小伙伴一定不陌生，对照handle、eventBus去理解，甚至js中的dispatchEvent事件。</p> <p>应用场景：待支付订单列表A页面进入订单详情B页面并完成支付，此时通知订单列表A页面刷新数据，诸如此类。</p> <h3 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h3> <ul><li>eventChannel: 用于页面间事件通讯</li> <li>events: 监听被打开页面传递给当前页面的数据</li> <li>eventChannel.emit: 触发一个事件</li> <li>eventChannel.on: 监听一个事件</li></ul> <h3 id="使用-2"><a href="#使用-2" class="header-anchor">#</a> 使用</h3> <p>当前页触发跳转页面事件，跳转到test页面（非tabbar页面）</p> <div class="language-js extra-class"><pre class="language-js"><code>wx<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    url<span class="token operator">:</span> <span class="token string">'/pages/test'</span><span class="token punctuation">,</span>
    events<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 监听事件</span>
        <span class="token function-variable function">myEvent</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// do something</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'被打开的页面给我传数据了'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">testEvent</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment">// 打印：test</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 触发myEvent事件</span>
      res<span class="token punctuation">.</span>eventChannel<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'myEvent'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>data<span class="token operator">:</span> <span class="token string">'now'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>test页面接收/传递数据</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">onLoad</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> eventChannel <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getOpenerEventChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// 监听当前页面触发的事件</span>
      eventChannel<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'myEvent'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// do something</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment">// 打印：now</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      eventChannel<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'testEvent'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>data<span class="token operator">:</span> <span class="token string">'test'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="vant-weapp使用"><a href="#vant-weapp使用" class="header-anchor">#</a> vant-weapp使用</h2> <p>在微信小程序中使用vant-weapp组件库，可以直接用npm安装使用，具体<a href="https://github.com/youzan/vant-weapp" target="_blank" rel="noopener noreferrer">请戳这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h2 id="wxs应用"><a href="#wxs应用" class="header-anchor">#</a> wxs应用</h2> <p>wxs是小程序的一套脚本语言(和js非常非常像，但是对es6支持的不够友好)，无法与js互相调用，它可以运行在wxml中。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 定义一个wxs文件 util.wxs</span>
<span class="token comment">// 格式化价格</span>
<span class="token keyword">function</span> <span class="token function">formatPrice</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>num<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 元</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>formatPrice <span class="token operator">=</span> formatPrice
</code></pre></div><p>wxml文件中使用</p> <div class="language-html extra-class"><pre class="language-html"><code>// 引入
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wxs</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./util.wxs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">module</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>util<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>wxs</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>商品价格：{{util.formatPrice(num)}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="input标签"><a href="#input标签" class="header-anchor">#</a> input标签</h2> <p>注意一个坑，原生input标签不支持readonly属性，目前没找到好的解决方式。</p> <h2 id="自定义组件slot"><a href="#自定义组件slot" class="header-anchor">#</a> <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html#%E7%BB%84%E4%BB%B6wxml%E7%9A%84slot" target="_blank" rel="noopener noreferrer">自定义组件slot<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h2> <p>和vue组件插槽用法相似，需要注意的一点是，组件中有多个插槽需要在组件中声明一下启用多插槽，否则无效。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  options<span class="token operator">:</span> <span class="token punctuation">{</span>
    multipleSlots<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 在组件定义时的选项中启用多slot支持</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="自定义组件外部样式定义"><a href="#自定义组件外部样式定义" class="header-anchor">#</a> 自定义组件外部样式定义</h2> <p>自定义组件可以开启接收外部样式的声明，这样别人用你的组件时可自定义外观。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 组件card中定义外部样式类名</span>
<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  externalClasses<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'custom-class'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>组件card中使用class</p> <div class="language-html extra-class"><pre class="language-html"><code>// 接收外部定义的样式
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>origin-class custom-class<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>测试<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>外部页面使用组件card</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>card</span> <span class="token attr-name">custom-class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>my-custom-class<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>card</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div> <h2 id="自定义nav"><a href="#自定义nav" class="header-anchor">#</a> 自定义nav</h2> <p>思路其实挺简单，取消掉自带的nav，把自己写的nav放在页面最顶部即可。</p> <h3 id="配置navigationstyle"><a href="#配置navigationstyle" class="header-anchor">#</a> 配置navigationStyle</h3> <p><code>navigationStyle</code>取值default则默认使用原生的导航；取值custom则只保留导航栏的胶囊按钮，页面自动从屏幕顶部开始渲染页面，我们把自定义的导航栏放在最顶部即可替代原来的导航栏位置。</p> <h4 id="全局配置"><a href="#全局配置" class="header-anchor">#</a> 全局配置</h4> <p>顾名思义即一键配置全部页面的<code>navigationStyle</code>样式，可在<code>app.json</code>中配置。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;window&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;navigationStyle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;custom&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意微信客户端最低版本要求6.6.0</p> <h4 id="单页面配置"><a href="#单页面配置" class="header-anchor">#</a> 单页面配置</h4> <p>如果只有一个或少量页面需自定义导航栏，可以给单个页面配置导航样式。比如home页面，只需配置<code>home.json</code>即可。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string">&quot;navigationStyle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;custom&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意微信客户端最低版本要求7.0.0</p> <h3 id="自定义导航栏"><a href="#自定义导航栏" class="header-anchor">#</a> 自定义导航栏</h3> <p>和其他组件一样的实现方式，我使用的是cover-view，保证用于最高的层级，防止在地图组件等层级较高的页面无法渲染出来。</p> <p>思路是利用flex布局，简单粗暴地分成左中右三块，右侧是胶囊占位。最下方留一块空白是防止下拉页面的时候导航栏页跟着下拉。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--自定义标题栏--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cover-view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token selector">height:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>statusBarHeight + navBarHeight<span class="token punctuation">}</span><span class="token punctuation">}</span>px<span class="token selector">;line-height:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>statusBarHeight + navBarHeight<span class="token punctuation">}</span><span class="token punctuation">}</span>px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!--左侧自定义图标--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cover-view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container-item container-item-left<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cover-image</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_toMain<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container-item-left-img<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/assets/images/icon-nav-main.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cover-view</span><span class="token punctuation">&gt;</span></span>

  <span class="token comment">&lt;!--中间标题--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cover-view</span> 
    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container-item container-item-mid container-item-mid-text<span class="token punctuation">&quot;</span></span><span class="token style-attr language-css"><span class="token attr-name"> 
    <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token selector">height:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>statusBarHeight + navBarHeight<span class="token punctuation">}</span><span class="token punctuation">}</span>px<span class="token selector">;line-height:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>statusBarHeight + navBarHeight + statusBarHeight<span class="token punctuation">}</span><span class="token punctuation">}</span>px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		  {{title}}
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cover-view</span><span class="token punctuation">&gt;</span></span>

  <span class="token comment">&lt;!--右侧胶囊占位--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cover-view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container-item <span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cover-view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cover-view</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cover-view</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token selector">height:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>statusBarHeight + navBarHeight<span class="token punctuation">}</span><span class="token punctuation">}</span>px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cover-view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>wxss文件</p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.container</span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">justify-content</span><span class="token punctuation">:</span> space-between<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.container-item</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 33.33%<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">align-items</span><span class="token punctuation">:</span> flex-end<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.container-item-left</span> <span class="token punctuation">{</span>
  <span class="token property">justify-content</span><span class="token punctuation">:</span> flex-start<span class="token punctuation">;</span>
  <span class="token property">padding-left</span><span class="token punctuation">:</span> 1rem<span class="token punctuation">;</span>
  <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 0.5rem<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.container-item-left-img</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 25px<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 25px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.container-item-mid</span> <span class="token punctuation">{</span>
  <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">padding-top</span><span class="token punctuation">:</span> 0.5rem<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.container-item-mid-text</span> <span class="token punctuation">{</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span> 18px<span class="token punctuation">;</span>
  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #333<span class="token punctuation">;</span>
  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
  <span class="token property">text-overflow</span><span class="token punctuation">:</span> ellipsis<span class="token punctuation">;</span>
  <span class="token property">white-space</span><span class="token punctuation">:</span> nowrap<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>js文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 这是工具函数，to是对跳转页面的封装</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> to <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../utils/util'</span>
<span class="token comment">// 获取全局应用实例</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">/**
   * 组件的属性列表
   */</span>
  properties<span class="token operator">:</span> <span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      value<span class="token operator">:</span> <span class="token string">'???'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 组件的初始数据
   */</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    navBarHeight<span class="token operator">:</span> <span class="token number">44</span><span class="token punctuation">,</span>       
    statusBarHeight<span class="token operator">:</span> <span class="token number">20</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">ready</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>app<span class="token punctuation">.</span>globalData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        statusBarHeight<span class="token operator">:</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>statusBarHeight<span class="token punctuation">,</span>
        navBarHeight<span class="token operator">:</span> app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>navBarHeight
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/**
   * 组件的方法列表
   */</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 跳转到mine个人信息页
     * @param {Object} e 
     */</span>
    <span class="token function-variable function">_toMine</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">to</span><span class="token punctuation">(</span><span class="token string">'/pages/mine/mine'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>app.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">onLaunch</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  globalData<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 定义全局数据</span>
    statusBarHeight<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
    navBarHeight<span class="token operator">:</span> <span class="token number">44</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/**
   * 获取手机系统信息
   */</span>
  <span class="token function-variable function">initData</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span><span class="token function">getSystemInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取手机系统数据</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>statusBarHeight <span class="token operator">=</span> res<span class="token punctuation">.</span>statusBarHeight
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'iphone'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>navBarHeight <span class="token operator">=</span> <span class="token number">44</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>navBarHeight <span class="token operator">=</span> <span class="token number">48</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="兼容低版本"><a href="#兼容低版本" class="header-anchor">#</a> 兼容低版本</h3> <p>可设置一个全局变量判断是否渲染自定义导航栏。<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html" target="_blank" rel="noopener noreferrer">详见兼容问题参考文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app.js中</span>
<span class="token comment">//app.js</span>
<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">onLaunch</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  globalData<span class="token operator">:</span> <span class="token punctuation">{</span>
    canUse<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    lowVersion<span class="token operator">:</span> <span class="token string">'7.0.0'</span><span class="token punctuation">,</span>
    lowSdkVersion<span class="token operator">:</span> <span class="token string">'2.4.3'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/**
   * 初始化系统参数
   */</span>
  <span class="token function-variable function">initData</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span><span class="token function">getSystemInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// 微信版本号和sdk版本号都符合要求才会渲染</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compareVersion</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>version<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>lowVersion<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> 
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compareVersion</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>SDKVersion<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>lowSdkVersion<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>canUse <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">compareVersion</span><span class="token punctuation">(</span><span class="token parameter">v1<span class="token punctuation">,</span> v2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    v1 <span class="token operator">=</span> v1<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
    v2 <span class="token operator">=</span> v2<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> len <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>length<span class="token punctuation">,</span> v2<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>v1<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      v1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>v2<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> len<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      v2<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> num1 <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>v1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token keyword">const</span> num2 <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>v2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>num1 <span class="token operator">&gt;</span> num2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>num1 <span class="token operator">&lt;</span> num2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/SOURCE/小程序.html">
          我与小程序二三事
        </a>
        →
      </span></p></div> </div> <div class="page"><section class="page-edit"><div style="border-top: 1px solid #eaecef;height: 1rem"></div> <div><span data-flag-title="Your Article Title" class="leancloud-visitors"><span class="post-meta-item-text">阅读量： </span> <span class="leancloud-visitors-count"></span></span></div> <div id="vcomments" style="margin-top: 1rem"></div></section></div> <!----> <!----></div></div>
    <script src="/assets/js/app.d2b44f7f.js" defer></script><script src="/assets/js/7.a1b3f1a1.js" defer></script>
  </body>
</html>
